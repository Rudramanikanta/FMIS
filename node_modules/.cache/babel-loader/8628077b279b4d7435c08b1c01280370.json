{"ast":null,"code":"import useMergedRefs from '@restart/hooks/useMergedRefs';\nimport useEventCallback from '@restart/hooks/useEventCallback';\nimport useIsomorphicEffect from '@restart/hooks/useIsomorphicEffect';\nimport React, { useRef, cloneElement, useState } from 'react';\nimport NoopTransition from './NoopTransition';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nexport function useTransition(_ref) {\n  let {\n    in: inProp,\n    onTransition\n  } = _ref;\n  const ref = useRef(null);\n  const isInitialRef = useRef(true);\n  const handleTransition = useEventCallback(onTransition);\n  useIsomorphicEffect(() => {\n    if (!ref.current) {\n      return undefined;\n    }\n\n    let stale = false;\n    handleTransition({\n      in: inProp,\n      element: ref.current,\n      initial: isInitialRef.current,\n      isStale: () => stale\n    });\n    return () => {\n      stale = true;\n    };\n  }, [inProp, handleTransition]);\n  useIsomorphicEffect(() => {\n    isInitialRef.current = false; // this is for strict mode\n\n    return () => {\n      isInitialRef.current = true;\n    };\n  }, []);\n  return ref;\n}\n/**\n * Adapts an imperative transition function to a subset of the RTG `<Transition>` component API.\n *\n * ImperativeTransition does not support mounting options or `appear` at the moment, meaning\n * that it always acts like: `mountOnEnter={true} unmountOnExit={true} appear={true}`\n */\n\nexport default function ImperativeTransition(_ref2) {\n  let {\n    children,\n    in: inProp,\n    onExited,\n    onEntered,\n    transition\n  } = _ref2;\n  const [exited, setExited] = useState(!inProp); // TODO: I think this needs to be in an effect\n\n  if (inProp && exited) {\n    setExited(false);\n  }\n\n  const ref = useTransition({\n    in: !!inProp,\n    onTransition: options => {\n      const onFinish = () => {\n        if (options.isStale()) return;\n\n        if (options.in) {\n          onEntered == null ? void 0 : onEntered(options.element, options.initial);\n        } else {\n          setExited(true);\n          onExited == null ? void 0 : onExited(options.element);\n        }\n      };\n\n      Promise.resolve(transition(options)).then(onFinish, error => {\n        if (!options.in) setExited(true);\n        throw error;\n      });\n    }\n  });\n  const combinedRef = useMergedRefs(ref, children.ref);\n  return exited && !inProp ? null : /*#__PURE__*/cloneElement(children, {\n    ref: combinedRef\n  });\n}\nexport function renderTransition(Component, runTransition, props) {\n  if (Component) {\n    return /*#__PURE__*/_jsx(Component, Object.assign({}, props));\n  }\n\n  if (runTransition) {\n    return /*#__PURE__*/_jsx(ImperativeTransition, Object.assign({}, props, {\n      transition: runTransition\n    }));\n  }\n\n  return /*#__PURE__*/_jsx(NoopTransition, Object.assign({}, props));\n}","map":{"version":3,"names":["useMergedRefs","useEventCallback","useIsomorphicEffect","React","useRef","cloneElement","useState","NoopTransition","jsx","_jsx","useTransition","in","inProp","onTransition","ref","isInitialRef","handleTransition","current","undefined","stale","element","initial","isStale","ImperativeTransition","children","onExited","onEntered","transition","exited","setExited","options","onFinish","Promise","resolve","then","error","combinedRef","renderTransition","Component","runTransition","props","Object","assign"],"sources":["D:/react/crp-project/crp/node_modules/@restart/ui/esm/ImperativeTransition.js"],"sourcesContent":["import useMergedRefs from '@restart/hooks/useMergedRefs';\nimport useEventCallback from '@restart/hooks/useEventCallback';\nimport useIsomorphicEffect from '@restart/hooks/useIsomorphicEffect';\nimport React, { useRef, cloneElement, useState } from 'react';\nimport NoopTransition from './NoopTransition';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nexport function useTransition({\n  in: inProp,\n  onTransition\n}) {\n  const ref = useRef(null);\n  const isInitialRef = useRef(true);\n  const handleTransition = useEventCallback(onTransition);\n  useIsomorphicEffect(() => {\n    if (!ref.current) {\n      return undefined;\n    }\n    let stale = false;\n    handleTransition({\n      in: inProp,\n      element: ref.current,\n      initial: isInitialRef.current,\n      isStale: () => stale\n    });\n    return () => {\n      stale = true;\n    };\n  }, [inProp, handleTransition]);\n  useIsomorphicEffect(() => {\n    isInitialRef.current = false;\n    // this is for strict mode\n    return () => {\n      isInitialRef.current = true;\n    };\n  }, []);\n  return ref;\n}\n/**\n * Adapts an imperative transition function to a subset of the RTG `<Transition>` component API.\n *\n * ImperativeTransition does not support mounting options or `appear` at the moment, meaning\n * that it always acts like: `mountOnEnter={true} unmountOnExit={true} appear={true}`\n */\nexport default function ImperativeTransition({\n  children,\n  in: inProp,\n  onExited,\n  onEntered,\n  transition\n}) {\n  const [exited, setExited] = useState(!inProp);\n\n  // TODO: I think this needs to be in an effect\n  if (inProp && exited) {\n    setExited(false);\n  }\n  const ref = useTransition({\n    in: !!inProp,\n    onTransition: options => {\n      const onFinish = () => {\n        if (options.isStale()) return;\n        if (options.in) {\n          onEntered == null ? void 0 : onEntered(options.element, options.initial);\n        } else {\n          setExited(true);\n          onExited == null ? void 0 : onExited(options.element);\n        }\n      };\n      Promise.resolve(transition(options)).then(onFinish, error => {\n        if (!options.in) setExited(true);\n        throw error;\n      });\n    }\n  });\n  const combinedRef = useMergedRefs(ref, children.ref);\n  return exited && !inProp ? null : /*#__PURE__*/cloneElement(children, {\n    ref: combinedRef\n  });\n}\nexport function renderTransition(Component, runTransition, props) {\n  if (Component) {\n    return /*#__PURE__*/_jsx(Component, Object.assign({}, props));\n  }\n  if (runTransition) {\n    return /*#__PURE__*/_jsx(ImperativeTransition, Object.assign({}, props, {\n      transition: runTransition\n    }));\n  }\n  return /*#__PURE__*/_jsx(NoopTransition, Object.assign({}, props));\n}"],"mappings":"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"},"metadata":{},"sourceType":"module"}